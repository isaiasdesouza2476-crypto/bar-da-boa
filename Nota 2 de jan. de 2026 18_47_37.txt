<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Raspadinha - Bar da Boa</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
        background-color: #f8f8f8;
    }
    #logo {
        width: 200px;
        margin-bottom: 20px;
    }
    #valueContainer, #loginContainer, #scratchContainer {
        margin-top: 20px;
    }
    button {
        padding: 15px 25px;
        font-size: 18px;
        margin: 5px;
        cursor: pointer;
    }
    #scratchContainer {
        display: none;
    }
    .scratch-card {
        position: relative;
        display: inline-block;
        margin: 10px;
    }
    .prize {
        width: 150px;
        height: 100px;
        line-height: 100px;
        background-color: #fffae6;
        font-weight: bold;
        color: #333;
        border: 2px solid #ccc;
        border-radius: 8px;
        user-select: none;
    }
    .canvas-overlay {
        position: absolute;
        top: 0;
        left: 0;
    }
    .disabled {
        opacity: 0.5;
        pointer-events: none;
    }
</style>
</head>
<body>

<!-- Logo do bar -->
<img id="logo" src="imagens/logo.png" alt="Logo do Bar">

<h1>Raspadinha - Bar da Boa</h1>

<!-- Etapa 1: escolher valor -->
<div id="valueContainer">
    <p>Escolha o valor consumido:</p>
    <button onclick="selectValue(25)">R$25</button>
    <button onclick="selectValue(50)">R$50</button>
    <button onclick="selectValue(75)">R$75</button>
    <button onclick="selectValue(100)">R$100</button>
</div>

<!-- Etapa 2: Senha do atendente -->
<div id="loginContainer" style="display:none">
    <p>Digite a senha do atendente:</p>
    <input type="password" id="password" placeholder="Senha">
    <button onclick="checkPassword()">Entrar</button>
    <p id="errorMsg" style="color:red;"></p>
</div>

<!-- Etapa 3: Cartela de raspadinhas -->
<div id="scratchContainer">
    <p>Escolha suas raspadinhas!</p>
    <div id="scratchArea"></div>
    <p id="remaining" style="font-weight:bold;"></p>
</div>

<script>
const correctPassword = "1430"; 
let scratchesAllowed = 0; 
let scratchesUsed = 0;

// Lista fixa de prÃªmios
let prizes = [
    "Vale uma cerveja ðŸº",
    "Vale uma cerveja ðŸº",
    "Vale um copÃ£o ðŸ»",
    "Vale um copÃ£o ðŸ»",
    "Vale 1 dose ðŸ¥ƒ",
    "Sem prÃªmio ðŸ˜¢",
    "Sem prÃªmio ðŸ˜¢",
    "Sem prÃªmio ðŸ˜¢",
    "Sem prÃªmio ðŸ˜¢",
    "Sem prÃªmio ðŸ˜¢"
];

// Selecionar valor pelo botÃ£o
function selectValue(value) {
    scratchesAllowed = value / 25;
    if(scratchesAllowed > 10) scratchesAllowed = 10;
    document.getElementById('valueContainer').style.display = "none";
    document.getElementById('loginContainer').style.display = "block";
}

// Verificar senha
function checkPassword() {
    const input = document.getElementById('password').value;
    const errorMsg = document.getElementById('errorMsg');
    if(input === correctPassword) {
        document.getElementById('loginContainer').style.display = "none";
        showScratches();
    } else {
        errorMsg.textContent = "Senha incorreta!";
    }
}

// Mostrar raspadinhas
function showScratches() {
    scratchesUsed = 0;
    document.getElementById('scratchContainer').style.display = "block";
    const scratchArea = document.getElementById('scratchArea');
    scratchArea.innerHTML = "";

    let shuffledPrizes = prizes.slice().sort(() => Math.random() - 0.5);

    for(let i=0; i<10; i++){
        const card = document.createElement('div');
        card.className = 'scratch-card';
        const prizeDiv = document.createElement('div');
        prizeDiv.className = 'prize';
        prizeDiv.textContent = shuffledPrizes[i];
        const canvas = document.createElement('canvas');
        canvas.width = 150;
        canvas.height = 100;
        canvas.className = 'canvas-overlay';
        card.appendChild(prizeDiv);
        card.appendChild(canvas);

        if(i >= scratchesAllowed){
            canvas.classList.add('disabled');
        } else {
            initScratch(canvas);
        }

        scratchArea.appendChild(card);
    }

    document.getElementById('remaining').textContent = `Raspadinhas restantes: ${scratchesAllowed - scratchesUsed}`;
}

// FunÃ§Ã£o de raspadinha otimizada para iPhone
function initScratch(canvas) {
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#AAAAAA';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.globalCompositeOperation = 'destination-out';
    let isDrawing = false;

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        let x, y;
        if(e.touches) {
            x = e.touches[0].clientX - rect.left;
            y = e.touches[0].clientY - rect.top;
        } else {
            x = e.clientX - rect.left;
            y = e.clientY - rect.top;
        }
        return {x, y};
    }

    function startPosition(e) {
        e.preventDefault();
        isDrawing = true;
        draw(e);
    }
    function endPosition(e) {
        e.preventDefault();
        if(isDrawing){
            isDrawing = false;
            ctx.beginPath();
        }
    }
    function draw(e) {
        e.preventDefault();
        if (!isDrawing) return;
        const pos = getPos(e);

        ctx.lineWidth = 20;
        ctx.lineCap = 'round';
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    }

    canvas.addEventListener('mousedown', startPosition);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', () => { endPosition(); countScratch(); });
    canvas.addEventListener('mouseleave', endPosition);

    canvas.addEventListener('touchstart', startPosition);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', () => { endPosition(); countScratch(); });
    canvas.addEventListener('touchcancel', endPosition);
}

// Contador de raspadinhas usadas
function countScratch() {
    scratchesUsed++;
    const remaining = scratchesAllowed - scratchesUsed;
    document.getElementById('remaining').textContent = `Raspadinhas restantes: ${remaining}`;
    if(remaining <= 0){
        document.querySelectorAll('.canvas-overlay:not(.disabled)').forEach(c => c.classList.add('disabled'));
    }
}
</script>

</body>
</html>