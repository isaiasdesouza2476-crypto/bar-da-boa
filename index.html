<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Raspadinha - Bar da Boa</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
        background-color: #f8f8f8;
    }
    #valueContainer, #loginContainer, #scratchContainer {
        margin-top: 20px;
    }
    input[type="number"], input[type="password"] {
        padding: 10px;
        font-size: 16px;
    }
    button {
        padding: 10px 20px;
        font-size: 16px;
        margin-left: 10px;
        cursor: pointer;
    }
    #scratchContainer {
        display: none;
    }
    .scratch-card {
        position: relative;
        display: inline-block;
        margin: 10px;
    }
    .prize {
        width: 150px;
        height: 100px;
        line-height: 100px;
        background-color: #fffae6;
        font-weight: bold;
        color: #333;
        border: 2px solid #ccc;
        border-radius: 8px;
        user-select: none;
    }
    .canvas-overlay {
        position: absolute;
        top: 0;
        left: 0;
    }
    .disabled {
        opacity: 0.5;
        pointer-events: none;
    }
</style>
</head>
<body>

<h1>Raspadinha - Bar da Boa</h1>

<!-- Etapa 1: Valor consumido -->
<div id="valueContainer">
    <p>Digite o valor que o cliente consumiu (R$):</p>
    <input type="number" id="consumption" min="25" step="25">
    <button onclick="calculateScratches()">Confirmar</button>
    <p id="valueError" style="color:red;"></p>
</div>

<!-- Etapa 2: Senha do atendente -->
<div id="loginContainer" style="display:none">
    <p>Digite a senha do atendente:</p>
    <input type="password" id="password" placeholder="Senha">
    <button onclick="checkPassword()">Entrar</button>
    <p id="errorMsg" style="color:red;"></p>
</div>

<!-- Etapa 3: Cartela de raspadinhas -->
<div id="scratchContainer">
    <p>Escolha suas raspadinhas!</p>
    <div id="scratchArea"></div>
    <p id="remaining" style="font-weight:bold;"></p>
</div>

<script>
const correctPassword = "1430"; // Senha do atendente
let scratchesAllowed = 0; // Quantas raspadinhas o cliente pode raspar
let scratchesUsed = 0; // Quantas jÃ¡ raspou

// Lista fixa de prÃªmios para 10 raspadinhas
let prizes = [
    "Vale uma cerveja ğŸº",
    "Vale uma cerveja ğŸº",
    "Vale um copÃ£o ğŸ»",
    "Vale um copÃ£o ğŸ»",
    "Vale 1 dose ğŸ¥ƒ",
    "Sem prÃªmio ğŸ˜¢",
    "Sem prÃªmio ğŸ˜¢",
    "Sem prÃªmio ğŸ˜¢",
    "Sem prÃªmio ğŸ˜¢",
    "Sem prÃªmio ğŸ˜¢"
];

// Etapa 1: calcular raspadinhas permitidas
function calculateScratches() {
    const value = parseInt(document.getElementById('consumption').value);
    const error = document.getElementById('valueError');
    if (!value || value < 25) {
        error.textContent = "Digite um valor vÃ¡lido (mÃ­nimo R$25).";
        return;
    }
    scratchesAllowed = Math.floor(value / 25);
    if(scratchesAllowed > 10) scratchesAllowed = 10;
    error.textContent = "";
    document.getElementById('valueContainer').style.display = "none";
    document.getElementById('loginContainer').style.display = "block";
}

// Etapa 2: verificar senha do atendente
function checkPassword() {
    const input = document.getElementById('password').value;
    const errorMsg = document.getElementById('errorMsg');
    if(input === correctPassword) {
        document.getElementById('loginContainer').style.display = "none";
        showScratches();
    } else {
        errorMsg.textContent = "Senha incorreta!";
    }
}

// Etapa 3: mostrar raspadinhas
function showScratches() {
    document.getElementById('scratchContainer').style.display = "block";
    const scratchArea = document.getElementById('scratchArea');
    scratchArea.innerHTML = "";

    // Embaralhar prÃªmios para cada cartela
    let shuffledPrizes = prizes.slice().sort(() => Math.random() - 0.5);

    for(let i=0; i<10; i++){
        const card = document.createElement('div');
        card.className = 'scratch-card';
        const prizeDiv = document.createElement('div');
        prizeDiv.className = 'prize';
        prizeDiv.textContent = shuffledPrizes[i];
        const canvas = document.createElement('canvas');
        canvas.width = 150;
        canvas.height = 100;
        canvas.className = 'canvas-overlay';
        card.appendChild(prizeDiv);
        card.appendChild(canvas);

        if(i >= scratchesAllowed){
            canvas.classList.add('disabled');
        } else {
            initScratch(canvas);
        }

        scratchArea.appendChild(card);
    }

    document.getElementById('remaining').textContent = `Raspadinhas restantes: ${scratchesAllowed - scratchesUsed}`;
}

// FunÃ§Ã£o para tornar cada raspadinha interativa
function initScratch(canvas) {
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#AAAAAA';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.globalCompositeOperation = 'destination-out';
    let isDrawing = false;

    function startPosition(e) {
        isDrawing = true;
        draw(e);
    }
    function endPosition() {
        if(isDrawing){
            isDrawing = false;
            ctx.beginPath();
        }
    }
    function draw(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        let x = e.clientX || e.touches[0].clientX;
        let y = e.clientY || e.touches[0].clientY;
        x -= rect.left;
        y -= rect.top;

        ctx.lineWidth = 20;
        ctx.lineCap = 'round';
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
    }

    canvas.addEventListener('mousedown', startPosition);
    canvas.addEventListener('mouseup', () => {
        endPosition();
        countScratch();
        canvas.removeEventListener('mousedown', startPosition);
    });
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('touchstart', startPosition);
    canvas.addEventListener('touchend', () => {
        endPosition();
        countScratch();
        canvas.removeEventListener('touchstart', startPosition);
    });
    canvas.addEventListener('touchmove', draw);
}

// Contador de raspadinhas usadas
function countScratch() {
    scratchesUsed++;
    const remaining = scratchesAllowed - scratchesUsed;
    document.getElementById('remaining').textContent = `Raspadinhas restantes: ${remaining}`;
    if(remaining <= 0){
        // Desativa todas as restantes
        document.querySelectorAll('.canvas-overlay:not(.disabled)').forEach(c => c.classList.add('disabled'));
    }
}
</script>

</body>
</html>
